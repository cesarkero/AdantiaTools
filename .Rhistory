tec2 <- "lbn"
#set parameters
PhotoFolder <- "C:\\GitHub\\AdantiaTools\\01_FotosTool\\Sources" #photo folder
ShpToJoin <- "Z:\\Proxectos\\448_Seguementos_PPEE_zonas_4b_5\\5_GIS\\SHP_PPEE\\PPEE.shp" #shp to join data
exiftags <- c("FileName", "CreateDate", "GPSPosition")
Tec1 <- "cac"
Tec2 <- "lbn"
files <- list.files(PhotoFolder, pattern="*.jpg|.JPG", full.names=T) # Read just .jpg files with exifr
p.files <- read_exif(files, tags=exiftags) # Select fields of interest
# newfile name from "AAAA:MM:DD HH:mm:ss" to "AAAAMMDD_HHmmss_001.jpg"
a <- str_replace(str_replace_all(p.files$CreateDate,":","")," ","_")
counter <- CreateCounter(nrow(p.files),3) #create counter
b <- paste0(a,"_",Tec1,"_",Tec2,"_",counter,".jpg") # create filename
# add a new collum with the previous newfilename to the table photos_sel
p.files <- mutate(p.files, newfilename = b)
# Rename files with the newfilename (in the photo folder and not into the wd)
file.rename(files,paste(p.folder,"\\",p.files$newfilename,sep=""))
p.files
# CREATE A TABLE WITH THE COLUMNS OF INTEREST
#create list of X_coord (ojo seleccion distinta de caracteres en hemisferio norte por el - en coord x)
coords <- strsplit(p.files$GPSPosition, " ")
X_coord_list <- c()
Y_coord_list <- c()
for (i in coords){
X_coord_list <-  c(X_coord_list, str_sub(i[2],9,start=1))
}
for (i in coords){
Y_coord_list <-  c(Y_coord_list, str_sub(i[1],8,start=1))
}
X_coord_list
Y_coord_list
coords
coords[1]
class(coords)
p.files$GPSPosition
coords
for (i in coords){
X_coord_list <-  c(X_coord_list, str_sub(i[2],9,start=1))
}
for (i in coords){
Y_coord_list <-  c(Y_coord_list, str_sub(i[1],9,start=1))
}
X_coord_list
Y_coord_list
coords
coords[[|]]
coords[[1]]
coords[1]
coords[[1]]
coords[[1]][1]
length(coords[[1]][1])
nchar(coords[[1]][1])
nchar(coords[[1]][2])
coords[[1]][1]
coords[[1]][2]
if("stringr" %in% rownames(installed.packages()) == FALSE) {install.packages("stringr")}
library(stringr)
source("C:/GitHub/AdantiaTools/funciones.R")
p.files$GPSPosition
coords[[1]][1]
X_coord_list
Y_coord_list
p.files$GPSPosition
coords[[1]][1]
class(coords[[1]][1])
a<-coords[[1]][1]
sub('.*','',a)
sub('\\.*','',a)
sub('\\..*','',a)
a<-coords[[1]][2]
sub('\\..*','',a)
sub('\\...*','',a)
a<-coords[[1]][2]
sub('\\....*','',a)
sub('\\.*','',a)
sub('\\..*','.',a)
a<-coords[[1]][1]
sub('\\..*','.',a)
sub('.*\\','.',a)
sub('.*\\.','.',a)
sub('.*\\.','',a)
sub('.*\\..','.',a)
sub('.*\\.','.',a)
a<-coords[[1]][1]
sub('\\..*','',a)
sub('.*\\.','.',a)
a<-coords[[1]][2]
sub('\\..*','',a)
sub('.*\\.','.',a)
y<- coords[[1]][1]
x<- coords[[1]][2]
num <- sub('\\..*','',a)
dec <- sub('.*\\.','.',a)
paste0()
cor <- paste0(num,dec)
cor
p.files$GPSPosition
p.files
num <- sub('\\..*','',x)
num
dec <- sub('.*\\.','.',x)
dec
cor <- paste0(num,dec)
cor
num <- sub('..*','',x)
num
num <- sub('...*','',x)
num
x<- coords[[1]][2]
num <- sub('...*','',x)
num
num <- sub('.\\.*','',x)
num
num <- sub('..\\.*','',x)
num
dec <- sub('.*\\.','.',x)
num <- sub('.*\\.','',x)
num
num <- sub('.*.','',x)
num
num <- sub('\\','',x)
num
num
num <- sub('.\\.','',x)
dec <- sub('.*\\.','.',x)
num <- sub('.\\.','',x)
num
num <- sub('..\\','',x)
num
num <- sub('..\\','',x)
num <- sub('.*\\','',x)
num
num <- sub('.\\.','',x)
num
num <- sub('.\\*','',x)
num
num <- sub('.\\.*','',x)
num
num <- sub('..','',x)
num
num <- sub('...','',x)
num
num <- sub('*','',x)
num
num <- sub('*\\','',x)
num <- sub('*.\\','',x)
num
num <- sub('*\\.','',x)
num
num <- sub('*\\.*','',x)
num
num <- sub('*\\.*','',x)
num
num <- sub('*\\*','',x)
num
num <- sub('..\\.*','',x)
num
dec <- sub('..\\.*','.',x)
dec
dec <- sub('..\\','.',x)
dec <- sub('..\\.*','.',x)
dec
dec <- sub('...\\.*','.',x)
dec
cor <- paste0(num,dec)
dec <- sub('.\\.*','.',x)
dec
dec <- sub('.\\.*','',x)
dec
dec <- sub('..\\.*','',x)
dec
num <- sub('\\.*','',x)
num
num <- sub('\\..*','',x)
num
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
num
dec <- sub('..\\.*','',x)
dec
x
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
num
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
p.files$GPSPosition
class(p.files$GPSPosition)
class(p.files$GPSPosition)
class(p.files$GPSPosition)[1]
p.files$GPSPosition[1]
p.files$GPSPosition
class(p.files)
X_coord_list
Y_coord_list
#separar x e y en columnas y unificar los decimales 5
p.files$FileName
#separar x e y en columnas y unificar los decimales 5
p.files$newfilename
X_coord_list
Y_coord_list
XYdf <- data.frame(newfilenames = p.files$newfilename,
x = X_coord_list,
y = Y_coord_list)
XYdf
p.files$GPSPosition
y<- coords[[1]][1]
x<- coords[[1]][2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,dec)
cor
coords
for (i in coords){
print(i)
}
i <- coords[1]
i
coords
i <- coords[1]
i
X_coord_list <- c()
Y_coord_list <- c()
i <- coords[1]
i
X_coord_list <- c()
Y_coord_list <- c()
y <- i[1]
x <- i[2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,dec)
cor
num
y <- i[1]
y
i
y <- i[[1]]
y
coords
i <- coords[1]
i
for (i in coords){
print(i)
}
for (i in coords){
print(i[1])
}
i <- coords[[1]]
i
y <- i[1]
y
i <- coords[[1]]
X_coord_list <- c()
Y_coord_list <- c()
y <- i[1]
x <- i[2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,dec)
cor
cor <- paste0(num,'.',dec)
cor
dec <- sub('..\\...*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,'.',dec)
cor
dec <- sub('..\\......*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,'.',dec)
cor
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
num
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,dec)
cor
dec
dec <- sub('.\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.*.....','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.*.....\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.*.....\\..*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.....\\..*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.....\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.....*\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\+.....\\.*','',x) #mantiene todo lo que hay detras de un punto
FotosTool <- function (PhotoFolder, ShpToJoin, exiftags, Tec1, Tec2){
files <- list.files(PhotoFolder, pattern="*.jpg|.JPG", full.names=T) # Read just .jpg files with exifr
p.files <- read_exif(files, tags=exiftags) # Select fields of interest
# newfile name from "AAAA:MM:DD HH:mm:ss" to "AAAAMMDD_HHmmss_001.jpg"
a <- str_replace(str_replace_all(p.files$CreateDate,":","")," ","_")
counter <- CreateCounter(nrow(p.files),3) #create counter
filename <- paste0(a,"_",Tec1,"_",Tec2,"_",counter,".jpg") # create filename
p.files <- mutate(p.files, newfilename = filename) #add new column with filename
file.rename(files,paste(p.folder,"\\",p.files$newfilename,sep="")) # Rename files with the newfilename
#separar x e y en columnas y unificar los decimales 5
coords <- strsplit(p.files$GPSPosition, " ") #splits unique text of coords into y,x list
coords
i <- coords[[1]]
X_coord_list <- c()
Y_coord_list <- c()
for (i in coords){
y <- i[1]
x <- i[2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,'.',dec)
cor
}
y <- i[[1]]
y
x <- i[[2]]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
num
dec <- sub('..\\+.....\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
cor <- paste0(num,dec)
cor
y<- coords[[1]][1]
x<- coords[[1]][2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- sub('..\\.*','',x) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,dec)
X_coord_list <- c()
Y_coord_list <- c()
for (i in coords){
X_coord_list <-  c(X_coord_list, str_sub(i[2],9,start=1))
}
for (i in coords){
Y_coord_list <-  c(Y_coord_list, str_sub(i[1],9,start=1))
}
X_coord_list
Y_coord_list
XYdf <- data.frame(newfilenames = p.files$newfilename,
x = X_coord_list,
y = Y_coord_list)
XYdf
# Add collums from exif data:
p.files <-
p.files %>%
mutate(X_coord = X_coord_list)%>%
mutate(Y_coord = Y_coord_list)%>%
mutate(Ano = str_sub(p.files$CreateDate,1,4))%>%
mutate(Mes = str_sub(p.files$CreateDate,6,7))%>%
mutate(Dia = str_sub(p.files$CreateDate,9,10))%>%
mutate(Hora = str_sub(p.files$CreateDate,12,13))%>%
mutate(Min = str_sub(p.files$CreateDate,15,16))%>%
mutate(Seg = str_sub(p.files$CreateDate,18,19))
# addd a new collum with the previous newfilepath to the table photos_sel
p.files <- mutate(p.files, newfilepath = paste0(p.folder,"\\",newfilename))
#modify colnames and save file
file_name <- paste(p.folder,"\\","fotos_vinculada.csv",sep="")
colnames(p.files) <- c("SourceFile","FileName","CreateDate",
"GPSPosition","newfilename","X_coord",
"Y_coord","Ano","Mes","Dia","Hora","Min",
"Seg","filepath")
write.csv2(p.files, file = file_name,row.names=FALSE, na="")
}
dec <- sub('..\\+.....\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('..\\.*.....\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('.......\\...*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('.......\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
num
dec <- sub('.......\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('...\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('...\\.*\\......','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('...\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- left(sub('...\\.*','',x),5) #mantiene todo lo que hay detras de un punto
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
num
dec <- subst(sub('..*.....\\','',x),5) #mantiene todo lo que hay detras de un punto
dec
dec <- subst(sub('...\\.*','',x),5) #mantiene todo lo que hay detras de un punto
dec
dec <- sub('...\\.*','',x) #mantiene todo lo que hay detras de un punto
dec
dec <- substr(sub('...\\.*','',x),5)#mantiene todo lo que hay detras de un punto
dec
dec <- substr(sub('...\\.*','',x),1,5)#mantiene todo lo que hay detras de un punto
dec
dec <- substr(sub('...\\.*','',x),1,5) #mantiene 5 char detras de un punto
dec
y <- i[1]
x <- i[2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,'.',dec)
cor
i <- coords[[2]]
y <- i[1]
x <- i[2]
num <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
dec <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
cor <- paste0(num,'.',dec)
cor
XYdf <- data.frame(newfilenames = character(),
x = numeric(),
y = numeric())
i<- coords[[1]]
x <- i[2]
numX <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
decX <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
corX <- paste0(numX,'.',decX)
y <- i[1]
numY <- sub('\\..*','',y) #mantiene todo lo que hay delante de un punto
decY <- substr(sub('...\\.*','',y),1,5) #mantiene todo lo que hay detras de un punto
corY <- paste0(numY,'.',decY)
photocor <- list(p.files$newfilename, corX, corY)
photocor
length(p.files)
length(p.files$GPSPosition)
i <- 1
x <- coords[[2]][i]
coords <- strsplit(p.files$GPSPosition, " ") #splits unique text of coords into y,x list
XYdf <- data.frame(newfilenames = character(),
x = numeric(),
y = numeric())
i <- 1
x <- coords[[2]][i]
numX <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
decX <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
corX <- paste0(numX,'.',decX)
y <- coords[[1]][i]
numY <- sub('\\..*','',y) #mantiene todo lo que hay delante de un punto
decY <- substr(sub('...\\.*','',y),1,5) #mantiene todo lo que hay detras de un punto
corY <- paste0(numY,'.',decY)
photocor <- list(p.files$newfilename[i], corX, corY)
photocor
XYdf[1,] <- c(p.files$newfilename[i], corX, corY)
XYdf[1,]
XYdf <- data.frame(newfilenames = character(),
x = numeric(),
y = numeric())
i <- 1
x <- coords[[2]][i]
numX <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
decX <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
corX <- paste0(numX,'.',decX)
y <- coords[[1]][i]
numY <- sub('\\..*','',y) #mantiene todo lo que hay delante de un punto
decY <- substr(sub('...\\.*','',y),1,5) #mantiene todo lo que hay detras de un punto
corY <- paste0(numY,'.',decY)
photocor <- list(p.files$newfilename[i], corX, corY)
photocor
XYdf[1,]
XYdf[1,] <- c(p.files$newfilename[i], corX, corY)
x <- coords[[2]][i]
numX <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
decX <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
corX <- paste0(numX,'.',decX)
corX
x <- coords[[2]][i]
x
x <- coords[[i]][2]
x
x <- coords[[i]][2]
i <- 1
x <- coords[[i]][2]
numX <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
decX <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
corX <- paste0(numX,'.',decX)
corX
y <- coords[[i]][1]
numY <- sub('\\..*','',y) #mantiene todo lo que hay delante de un punto
decY <- substr(sub('...\\.*','',y),1,5) #mantiene todo lo que hay detras de un punto
corY <- paste0(numY,'.',decY)
photocor <- list(p.files$newfilename[i], corX, corY)
photocor
XYdf[1,]
p.files$newfilename[i]
class(p.files$newfilename[i])
class(XYdf$x)
class(XYdf$newfilenames)
XYdf <- data.frame(newfilenames,
x = numeric(),
y = numeric())
XYdf <- data.frame(newfilenames,
x = numeric(),
y = numeric())
XYdf <- data.frame(newfilenames = numeric(),
x = numeric(),
y = numeric())
i <- 1
x <- coords[[i]][2]
numX <- sub('\\..*','',x) #mantiene todo lo que hay delante de un punto
corX <- paste0(numX,'.',decX)
corX
y <- coords[[i]][1]
decX <- substr(sub('...\\.*','',x),1,5) #mantiene todo lo que hay detras de un punto
numY <- sub('\\..*','',y) #mantiene todo lo que hay delante de un punto
decY <- substr(sub('...\\.*','',y),1,5) #mantiene todo lo que hay detras de un punto
corY <- paste0(numY,'.',decY)
photocor <- list(p.files$newfilename[i], corX, corY)
photocor
class(p.files$newfilename[i])
class(XYdf$newfilenames)
XYdf[1,]
XYdf[1,] <- c(p.files$newfilename[i], corX, corY)
XYdf
